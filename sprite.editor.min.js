!function(t,i,s){var e=i.editor={},o={brushColor:"black",uncolored:"none"},n=e.Model=function(i,e,n){t.Observable.call(this),n=n||{};for(var h in o)this[h]=n[h]!==s?n[h]:o[h];this.columns=i,this.rows=e,this.pixels={}};n.prototype=Object.create(t.Observable.prototype),n.prototype.constructor=n,n.prototype.paintPixel=function(t,i){if(0>t||t>=this.columns||0>i||i>=this.rows)throw new Error("Not within bounds: ("+t+","+i+")");var s=this.pixels[t]=this.pixels[t]||{};s[i]=this.brushColor,this.signal("paint",t,i,this.brushColor)},n.prototype.colorAt=function(t,i){return this.pixels[t]&&this.pixels[t][i]?this.pixels[t][i]:this.uncolored},n.prototype.increaseColumns=function(){this.columns+=1,this.signal("dimension",this.columns,this.rows)},n.prototype.decreaseColumns=function(){this.columns>1&&delete this.pixels[this.columns-1],this.columns=Math.max(this.columns-1,1),this.signal("dimension",this.columns,this.rows)},n.prototype.increaseRows=function(){this.rows+=1,this.signal("dimension",this.columns,this.rows)},n.prototype.decreaseRows=function(){if(this.rows>1)for(var t in this.pixels)delete this.pixels[t][this.rows-1];this.rows=Math.max(this.rows-1,1),this.signal("dimension",this.columns,this.rows)},n.prototype.changeBrushColor=function(t){this.brushColor=t!==s?t:o.brushColor,this.signal("color",this.brushColor)},n.prototype.forEachPixel=function(t){for(var i in this.pixels)for(var s in this.pixels[i])t(Number.parseInt(i),Number.parseInt(s),this.pixels[i][s])};var h=i.editor.View=function(t,i){this.model=t,this.canvas=i,this.model.on("paint",this.update.bind(this)),this.model.on("dimension",this.initialize.bind(this)),this.initialize()};h.prototype.initialize=function(){this.pixelSize=Math.min(this.canvas.width/this.model.columns,this.canvas.height/this.model.rows),this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.horizontalOffset=(this.canvas.width-this.model.columns*this.pixelSize)/2,this.verticalOffset=(this.canvas.height-this.model.rows*this.pixelSize)/2,this.update()},h.prototype.update=function(){this.model.forEachPixel(function(t,i,s){this.context.save(),this.context.clearRect(t*this.pixelSize+this.horizontalOffset,i*this.pixelSize+this.verticalOffset,this.pixelSize,this.pixelSize),this.context.fillStyle=s,this.context.fillRect(t*this.pixelSize+this.horizontalOffset,i*this.pixelSize+this.verticalOffset,this.pixelSize,this.pixelSize),this.context.restore()}.bind(this)),this.grid()},h.prototype.grid=function(){this.context.save(),this.context.strokeStyle="gray",this.context.beginPath();for(var t=0;t<=this.model.columns;t++)this.context.moveTo(t*this.pixelSize+this.horizontalOffset,this.verticalOffset),this.context.lineTo(t*this.pixelSize+this.horizontalOffset,this.canvas.height-this.verticalOffset);for(var i=0;i<=this.model.rows;i++)this.context.moveTo(this.horizontalOffset,i*this.pixelSize+this.verticalOffset),this.context.lineTo(this.canvas.width-this.horizontalOffset,i*this.pixelSize+this.verticalOffset);this.context.stroke(),this.context.restore()};var r=function(t,i,s){this.model=t,this.view=i,this.canvas=s,this.drawing=!1,this.boundReceivePaintEvent=this.receivePaintEvent.bind(this)};r.prototype.startDrawing=function(t){this.drawing||(this.drawing=!0,this.boundReceivePaintEvent(t),this.canvas.addEventListener("mousemove",this.boundReceivePaintEvent))},r.prototype.stopDrawing=function(t){this.drawing&&(this.drawing=!1,this.boundReceivePaintEvent(t),this.canvas.removeEventListener("mousemove",this.boundReceivePaintEvent))},r.prototype.receivePaintEvent=function(t){var i=t.clientX-this.view.horizontalOffset-this.canvas.offsetLeft,s=t.clientY-this.view.verticalOffset-this.canvas.offsetTop,e=Math.floor(i/this.view.pixelSize),o=Math.floor(s/this.view.pixelSize);try{this.model.paintPixel(e,o)}catch(n){if(!n.message.match(/^Not within bounds/))throw n}},e.controllerFor=function(t,i,s){return new r(t,i,s)}}(ns,window.sprite=window.sprite||{});