!function(t,i,s){var e=i.editor={},o={brushColor:"black",uncolored:"none"},h=e.Model=function(i,e,h){t.Observable.call(this),h=h||{};for(var n in o)this[n]=h[n]!==s?h[n]:o[n];this.columns=i,this.rows=e,this.pixels={}};h.prototype=Object.create(t.Observable.prototype),h.prototype.constructor=h,h.prototype.paintPixel=function(t,i){if(0>t||t>=this.columns||0>i||i>=this.rows)throw new Error("Not within bounds: ("+t+","+i+")");var s=this.pixels[t]=this.pixels[t]||{};s[i]=this.brushColor,this.signal("paint",t,i,this.brushColor)},h.prototype.colorAt=function(t,i){return this.pixels[t]&&this.pixels[i]?this.pixels[t][i]:this.uncolored},h.prototype.increaseColumns=function(){this.columns+=1,this.signal("dimension",this.columns,this.rows)},h.prototype.decreaseColumns=function(){if(this.columns>1)for(var t in this.pixels)delete this.pixels[t][this.columns];this.columns=Math.max(this.columns-1,1),this.signal("dimension",this.columns,this.rows)},h.prototype.increaseRows=function(){this.rows+=1,this.signal("dimension",this.columns,this.rows)},h.prototype.decreaseRows=function(){this.rows>1&&delete this.pixels[this.rows],this.rows=Math.max(this.rows-1,1),this.signal("dimension",this.columns,this.rows)},h.prototype.changeBrushColor=function(t){this.brushColor=t!==s?t:o.brushColor,this.signal("color",this.brushColor)},h.prototype.forEachPixel=function(t){for(var i in this.pixels)for(var s in this.pixels[i])t(i,s,this.pixels[i][s])};var n=i.editor.View=function(t,i){this.model=t,this.canvas=i,this.model.on("paint",this.update.bind(this)),this.initialize(),this.update()};n.prototype.initialize=function(){this.pixelSize=Math.min(this.canvas.width/this.model.columns,this.canvas.height/this.model.rows),this.context=this.canvas.getContext("2d"),this.horizontalOffset=(this.canvas.width-this.model.columns*this.pixelSize)/2,this.verticalOffset=(this.canvas.height-this.model.rows*this.pixelSize)/2},n.prototype.update=function(){this.model.forEachPixel(function(t,i,s){this.context.save(),this.context.clearRect(t*this.pixelSize+this.horizontalOffset,i*this.pixelSize+this.verticalOffset,this.pixelSize,this.pixelSize),this.context.fillStyle=s,this.context.fillRect(t*this.pixelSize+this.horizontalOffset,i*this.pixelSize+this.verticalOffset,this.pixelSize,this.pixelSize),this.context.restore()}.bind(this)),this.grid()},n.prototype.grid=function(){this.context.save(),this.context.strokeStyle="gray",this.context.beginPath();for(var t=0;t<=this.model.columns;t++)this.context.moveTo(t*this.pixelSize+this.horizontalOffset,this.verticalOffset),this.context.lineTo(t*this.pixelSize+this.horizontalOffset,this.canvas.height-this.verticalOffset);for(var i=0;i<=this.model.rows;i++)this.context.moveTo(this.horizontalOffset,i*this.pixelSize+this.verticalOffset),this.context.lineTo(this.canvas.width-this.horizontalOffset,i*this.pixelSize-this.verticalOffset);this.context.stroke(),this.context.restore()};var r=function(t,i,s){this.model=t,this.view=i,this.canvas=s,this.drawing=!1,this.boundReceivePaintEvent=this.receivePaintEvent.bind(this)};r.prototype.startDrawing=function(t){this.drawing||(this.drawing=!0,this.boundReceivePaintEvent(t),this.canvas.addEventListener("mousemove",this.boundReceivePaintEvent))},r.prototype.stopDrawing=function(t){this.drawing&&(this.drawing=!1,this.boundReceivePaintEvent(t),this.canvas.removeEventListener("mousemove",this.boundReceivePaintEvent))},r.prototype.receivePaintEvent=function(t){var i=t.clientX-this.view.horizontalOffset-this.canvas.offsetLeft,s=t.clientY-this.view.verticalOffset-this.canvas.offsetTop,e=Math.floor(i/this.view.pixelSize),o=Math.floor(s/this.view.pixelSize);try{this.model.paintPixel(e,o)}catch(h){if(!h.message.match(/^Not within bounds/))throw h}},e.controllerFor=function(t,i,s){return new r(t,i,s)}}(ns,window.sprite=window.sprite||{});