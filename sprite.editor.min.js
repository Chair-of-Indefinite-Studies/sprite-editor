!function(t,i){var s=function(){this.observers={}};s.prototype.on=function(t,i){(this.observers[t]=this.observers[t]||[]).push(i)},s.prototype.signal=function(t){var i=Array.prototype.slice.call(arguments,1);(this.observers[t]||[]).forEach(function(t){t.apply(this,i)}.bind(this))};var o=t.editor={},e={brushColor:"black",uncolored:"none"},h=o.Model=function(t,o,h){s.call(this),h=h||{};for(var r in e)this[r]=h[r]!==i?h[r]:e[r];this.columns=t,this.rows=o,this.pixels={}};h.prototype=Object.create(s.prototype),h.prototype.constructor=h,h.prototype.paintPixel=function(t,i){if(0>t||t>=this.columns||0>i||i>=this.rows)throw new Error("Not within bounds: ("+t+","+i+")");var s=this.pixels[t]=this.pixels[t]||{};s[i]=this.brushColor,this.signal("paint",t,i,this.brushColor)},h.prototype.colorAt=function(t,i){return this.pixels[t]&&this.pixels[i]?this.pixels[t][i]:this.uncolored},h.prototype.changeBrushColor=function(t){this.brushColor=t!==i?t:e.brushColor,this.signal("color",this.brushColor)},h.prototype.forEachPixel=function(t){for(var i in this.pixels)for(var s in this.pixels[i])t(i,s,this.pixels[i][s])};var r=t.editor.View=function(t,i){this.model=t,this.canvas=i,this.model.on("paint",this.update.bind(this)),this.initialize(),this.update()};r.prototype.initialize=function(){this.pixelSize=Math.min(this.canvas.width/this.model.columns,this.canvas.height/this.model.rows),this.context=this.canvas.getContext("2d"),this.horizontalOffset=(this.canvas.width-this.model.columns*this.pixelSize)/2,this.verticalOffset=(this.canvas.height-this.model.rows*this.pixelSize)/2},r.prototype.update=function(){this.model.forEachPixel(function(t,i,s){this.context.save(),this.context.fillStyle=s,this.context.fillRect(t*this.pixelSize+this.horizontalOffset,i*this.pixelSize+this.verticalOffset,this.pixelSize,this.pixelSize),this.context.restore()}.bind(this)),this.grid()},r.prototype.grid=function(){this.context.save(),this.context.strokeStyle="gray",this.context.beginPath();for(var t=0;t<=this.model.columns;t++)this.context.moveTo(t*this.pixelSize+this.horizontalOffset,this.verticalOffset),this.context.lineTo(t*this.pixelSize+this.horizontalOffset,this.canvas.height-this.verticalOffset);for(var i=0;i<=this.model.rows;i++)this.context.moveTo(this.horizontalOffset,i*this.pixelSize+this.verticalOffset),this.context.lineTo(this.canvas.width-this.horizontalOffset,i*this.pixelSize-this.verticalOffset);this.context.stroke(),this.context.restore()},o.controllerFor=function(t,i){return function(s){var o=s.clientX-i.horizontalOffset-this.offsetLeft,e=s.clientY-i.verticalOffset-this.offsetTop,h=Math.floor(o/i.pixelSize),r=Math.floor(e/i.pixelSize);try{t.paintPixel(h,r)}catch(n){if(!n.message.match(/^Not within bounds/))throw n}}}}(window.sprite=window.sprite||{});